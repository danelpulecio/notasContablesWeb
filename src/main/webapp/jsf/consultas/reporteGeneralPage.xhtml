<ui:composition xmlns="http://www.w3.org/1999/xhtml"
				xmlns:ui="http://java.sun.com/jsf/facelets"
				xmlns:h="http://java.sun.com/jsf/html"
				xmlns:f="http://java.sun.com/jsf/core"
				xmlns:p="http://primefaces.org/ui"
				template="../../common/template.xhtml">
	<ui:param name="title" value="Reporte General" />
	<ui:define name="body">

		<ui:include src="../common/flujoSubPage.xhtml" />
		<ui:include src="../notacontable/flujoNotaContablePage.xhtml" />
		<ui:include src="../notacontable/flujoNotaContableLibrePage.xhtml"/>
		<ui:include src="../notacontable/flujoNotaRefCrucePage.xhtml"/>

		<!--Filtro de busqueda	-->
		<div style="width: auto;">

			<h:panelGrid columns="1" width="100%">
				<h1 align="center">Reporte General</h1>
			</h:panelGrid>

			<!-- Panel de opciones -->
			<h:panelGrid id="informacion" columns="1" width="100%" cellpadding="0" cellspacing="0">
				<p:accordionPanel label="Filtro de búsqueda" width="100%" widgetVar="client">
					<p:tab title="Filtro de búsqueda" id="tabBusquedaReporte" >
						<h:panelGrid columns="1" width="100%" cellpadding="0" cellspacing="5">

							<h:panelGrid columns="2">
								<h:outputText value="Tipo de Nota" />
								<h:selectOneMenu value="#{reporteGeneralPage.tipoNota}" immediate="true">

									<p:ajax event="change"  update="filtro"/>

									<f:selectItem itemValue="" itemLabel="Cualquiera"/>
									<f:selectItem itemValue="R" itemLabel="Registro Normal"/>
									<f:selectItem itemValue="L" itemLabel="Registro Libre"/>
									<f:selectItem itemValue="C" itemLabel="Cruce de Referencia"/>
								</h:selectOneMenu>
							</h:panelGrid>

							<h:panelGrid columns="2" id="filtro">
								<h:outputText value="Sucursal Origen"
											  rendered="#{reporteGeneralPage.usuarioLogueado.rolActual.codigo != 6 and reporteGeneralPage.usuarioLogueado.rolActual.codigo != 7 and reporteGeneralPage.usuarioLogueado.rolActual.codigo != 10}"/>
								<h:selectOneMenu value="#{reporteGeneralPage.sucOrigen}"
												 rendered="#{reporteGeneralPage.usuarioLogueado.rolActual.codigo != 6 and reporteGeneralPage.usuarioLogueado.rolActual.codigo != 7 and reporteGeneralPage.usuarioLogueado.rolActual.codigo != 10}">
									<f:selectItem itemValue="" itemLabel="Cualquiera"/>
									<f:selectItems value="#{reporteGeneralPage.sucursales}"/>
								</h:selectOneMenu>

								<h:outputText value="Sucursal Destino"/>
								<h:selectOneMenu value="#{reporteGeneralPage.sucDestino}">
									<f:selectItem itemValue="" itemLabel="Cualquiera"/>
									<f:selectItems value="#{reporteGeneralPage.sucursales}"/>
								</h:selectOneMenu>

								<h:outputText value="Concepto" rendered="#{reporteGeneralPage.tipoNota eq 'R'}"/>
								<h:selectOneMenu value="#{reporteGeneralPage.concepto}" rendered="#{reporteGeneralPage.tipoNota eq 'R'}">
									<f:selectItem itemValue="0" itemLabel="Cualquiera"/>
									<f:selectItems value="#{reporteGeneralPage.conceptos}"/>
									<p:ajax event="change" listener="#{reporteGeneralPage.buscarTemas}" update="globalForm:panelTemas"/>
								</h:selectOneMenu>

								<h:outputText value="Tema" rendered="#{reporteGeneralPage.tipoNota eq 'R'}"/>
								<h:panelGroup id="panelTemas" rendered="#{reporteGeneralPage.tipoNota eq 'R'}">
									<h:selectOneMenu value="#{reporteGeneralPage.tema}" rendered="#{!empty reporteGeneralPage.temas}">
										<f:selectItem itemValue="0" itemLabel="Cualquiera"/>
										<f:selectItems value="#{reporteGeneralPage.temas}"/>
									</h:selectOneMenu>
									<h:outputText value=""  rendered="#{empty reporteGeneralPage.temas}" />
								</h:panelGroup>

								<h:outputText value="Tipo de Evento" rendered="#{reporteGeneralPage.tipoNota eq 'R'}"/>
								<h:selectOneMenu value="#{reporteGeneralPage.tipoEvento}" rendered="#{reporteGeneralPage.tipoNota eq 'R'}">
									<f:selectItem itemValue="0" itemLabel="Cualquiera"/>
									<f:selectItems value="#{reporteGeneralPage.tiposEvento}"/>
								</h:selectOneMenu>

								<h:outputText value="Cuenta Contable" />
								<h:inputText value="#{reporteGeneralPage.partida}"/>

								<h:outputText value="Número Identificación" />
								<h:inputText value="#{reporteGeneralPage.numIdentificacion}"/>

								<h:outputText value="Desde" />
								<p:datePicker value="#{reporteGeneralPage.desde}" showIcon="true" monthNavigator="true" yearNavigator="true"/>

								<h:outputText value="Hasta" />
								<p:datePicker value="#{reporteGeneralPage.hasta}" showIcon="true" monthNavigator="true" yearNavigator="true"/>

								<h:outputText value="Divisa" />
								<h:selectOneMenu value="#{reporteGeneralPage.divisa}" >
									<f:selectItem itemValue="" itemLabel="Cualquiera"/>
									<f:selectItems value="#{reporteGeneralPage.divisas}"/>
								</h:selectOneMenu>

								<h:outputText value="Estado" />
								<h:selectOneMenu value="#{reporteGeneralPage.estado}" >
									<f:selectItem itemValue="" itemLabel="Cualquiera"/>
									<f:selectItem itemValue="0" itemLabel="Pendiente de aprobación por Subgenrente, Gerente, Área Central" />
									<f:selectItem itemValue="1" itemLabel="Pendiente de Revisión" />
									<f:selectItem itemValue="2" itemLabel="Pendiente de aprobación por Padrino - Unidad de Análisis" />
									<f:selectItem itemValue="3" itemLabel="Pendiente de aprobación ente Autorizador" />
									<f:selectItem itemValue="4" itemLabel="En Precierre" />
									<f:selectItem itemValue="5" itemLabel="En Cierre" />
									<f:selectItem itemValue="6" itemLabel="Cerrada" />
									<f:selectItem itemValue="9" itemLabel="Anulada" />
								</h:selectOneMenu>

								<h:outputText value="Descripción" rendered="#{reporteGeneralPage.tipoNota != 'C'}"/>
								<h:inputText value="#{reporteGeneralPage.descripcion}" rendered="#{reporteGeneralPage.tipoNota != 'C'}"/>

							</h:panelGrid>

							<h:panelGrid columns="1" styleClass="center">
								<p:commandButton action="#{reporteGeneralPage.buscar}"
												 update="globalForm:informacion,globalForm:lista,globalForm:lista2,globalForm:infoMsgRep" value="Buscar" />
							</h:panelGrid>
						</h:panelGrid>
					</p:tab>
				</p:accordionPanel>
			</h:panelGrid>

			<h:panelGrid columns="1" width="100%" id="infoMsgRep" styleClass="center">
				<ui:include src="../../common/mensajes.xhtml"/>
			</h:panelGrid>

			<!-- Tabla de registros -->

			<h:panelGrid columns="1" width="100%" style="align:center;" id="lista">

				<p:commandButton value="Generar Archivo Excel"
								 action="#{reporteGeneralPage.generarArchivoExcel}"
								 update="globalForm:lista"
								 rendered="#{! empty reporteGeneralPage.datos}"/>

				<p:commandLink styleClass="bold" action="#{downloadGeneralPage.download}" value="#{precierreCierrePage.excelFileName}"
							   target="_blank" rendered="#{precierreCierrePage.mostrarArchExc}" ajax="false">
					<f:setPropertyActionListener for="type1" value="#{downloadGeneralPage.REPORTE_EXCEL}" target="#{downloadGeneralPage.type}" />
					<f:setPropertyActionListener for="file1" value="#{precierreCierrePage.excelFileName}" target="#{downloadGeneralPage.file}"/>
				</p:commandLink>
			</h:panelGrid>

			<h:panelGrid columns="1" width="100%" style="align:center;" id="lista2">
				<p:dataTable value="#{reporteGeneralPage.datos}" var="dato" id="table" rowIndexVar="rowIndex"
							 widgetVar="economicActivityTable" rows="15" paginator="true" rendered="#{! empty reporteGeneralPage.datos}"
							 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
							 currentPageReportTemplate="{startRecord}-{endRecord} de {totalRecords} registros"
							 paginatorPosition="top">

					<p:column headerText="Número Radicación" sortable="true" sortBy="#{dato.NC.numeroRadicacion}" width="100px;">
						<h:outputText value="#{dato.NC.numeroRadicacion}" />
					</p:column>
					<p:column headerText="Sucursal Origen" sortable="true" sortBy="#{dato.sucursal.codigo}" width="85px;">
						<h:outputText value="#{dato.sucursal.codigo} : #{dato.sucursal.nombre}" />
					</p:column>
					<p:column headerText="Estado" sortable="true" sortBy="#{dato.estado}" width="70px">
						<h:outputText value="#{dato.nombreEstado}" />
					</p:column>
					<p:column headerText="Detalle de la nota contable" style="text-align: center; border-width: 0px;"  width="500px;">
						<h:panelGrid columns="1" rendered="#{dato.NC.tipoNota eq 'R' }" width="100%" border="0">
							<p:dataTable style="border-width: 0px; background-color: transparent;" var="tema" value="#{dato.NC.temas}">
								<p:column style="border-width: 0px; text-align: left;" >
									<h:outputText value="${tema.tema.nombre}" />
								</p:column>
								<p:column style="border-width: 0px; text-align: left;" width="80" >
									<h:panelGrid columns="1" cellpadding="0" cellspacing="0">
										<h:outputText value="#{tema.partidaContable} " />
										<h:outputText value="#{tema.contrapartidaContable}" />
									</h:panelGrid>
								</p:column>
								<p:column style="border-width: 0px; text-align: left;" width="33px" >
									<h:panelGrid columns="1" cellpadding="0" cellspacing="0" border="0" width="33px">
										<h:outputText value="[#{tema.naturalezaPartidaContable}]" />
										<h:outputText value="[#{tema.naturalezaContrapartidaContable}]" />
									</h:panelGrid>
								</p:column>
								<p:column style="border-width: 0px; text-align: left;" width="30" >
									<h:outputText value="#{tema.codigoDivisa}" />
								</p:column>
								<p:column style="border-width: 0px; text-align:right;" width="140">
									<h:outputText value="#{tema.monto}" ><f:convertNumber type="currency" /></h:outputText>
								</p:column>
							</p:dataTable>
						</h:panelGrid>

						<h:panelGrid columns="1" rendered="#{dato.NC.tipoNota eq 'C' }"  style="width: 100%" border="0">
							<p:dataTable style="border-width: 0px; background-color: transparent;" var="temaCruce" value="#{dato.NC.temasCruce}" cellpadding="0" cellspacing="0">
								<p:column style="border-width: 0px; text-align: left;" >
									<h:outputText value="REFERENCIA DE CRUCE" />
								</p:column>
								<p:column style="border-width: 0px; text-align: left;" width="80">
									<h:outputText value="${temaCruce.cuentaContable}" />
								</p:column>
								<p:column style="border-width: 0px; text-align: left;" width="20">
									<h:outputText value="[${temaCruce.naturaleza}]" />
								</p:column>
								<p:column style="border-width: 0px; text-align: left;" width="30">
									<h:outputText value="${temaCruce.divisa}" />
								</p:column>
								<p:column style="border-width: 0px; text-align:right;" width="140">
									<h:outputText value="#{temaCruce.importe}" ><f:convertNumber type="currency" /></h:outputText>
								</p:column>

							</p:dataTable>
						</h:panelGrid>
						<h:panelGrid columns="1" rendered="#{dato.NC.tipoNota eq 'L' }"  width="100%" border="0">
							<p:dataTable style="border-width: 0px; background-color: transparent; " var="temaLibre" value="#{dato.NC.temasLibre}" cellpadding="0" cellspacing="0">
								<p:column style="border-width: 0px; text-align: left;" >
									<h:outputText value="CONTABILIDAD LIBRE"/>
								</p:column>
								<p:column  style="border-width: 0px; text-align: left;" width="80">
									<h:outputText value="${temaLibre.cuentaContable}" />
								</p:column>
								<p:column style="border-width: 0px; text-align: left;" width="20">
									<h:outputText value="[${temaLibre.naturalezaCuentaContable}]" />
								</p:column>
								<p:column style="border-width: 0px; text-align: left;" width="30">
									<h:outputText value="${temaLibre.codigoDivisa}" />
								</p:column>
								<p:column style="border-width: 0px; text-align:right;" width="140">
									<h:outputText value="#{temaLibre.monto}"><f:convertNumber type="currency" /></h:outputText>
								</p:column>
							</p:dataTable>
						</h:panelGrid>
					</p:column>

					<p:column headerText="Ver Nota Contable" style="text-align: center;" width="50px;">


						<p:commandButton value="Ver"
										 oncomplete="PF('popupFlujoNotaContableVer').show();"
										 action="#{flujoNotaContablePage.consultarFlujo}"
										 update="globalForm:popupFlujoNotaContableVer"
										 rendered="#{dato.NC.tipoNota eq 'R'}">
							<f:setPropertyActionListener for="codNotaVer" value="#{dato.codigoNotaContable}" target="#{flujoNotaContablePage.nota.codigo}" />
						</p:commandButton>

						<p:commandButton value="Ver"
										 oncomplete="PF('notaContableLibreVer').show();"
										 action="#{flujoNotaContableLibrePage.consultarFlujo}"
										 update="globalForm:notaContableLibreVer"
										 rendered="#{dato.NC.tipoNota eq 'L'}">
							<f:setPropertyActionListener for="codNotaLibreVer" value="#{dato.codigoNotaContable}" target="#{flujoNotaContableLibrePage.nota.codigo}" />
						</p:commandButton>

						<p:commandButton value="Ver"
										 oncomplete="PF('popupFlujoNotaContableRefCruceVer').show();"
										 action="#{notaRefCrucePage.consultarFlujo}"
										 update="globalForm:popupFlujoNotaContableRefCruceVer"
										 rendered="#{dato.NC.tipoNota eq 'C'}">
							<f:setPropertyActionListener for="codNotaRefCruceVer" value="#{dato.codigoNotaContable}" target="#{notaRefCrucePage.nota.codigo}" />
						</p:commandButton>

					</p:column>
					<p:column headerText="Flujo Nota Contable" width="75px;" style="text-align: center;">

						<p:commandButton value="Consultar"
										 oncomplete="PF('popupFlujo').show()"
										 action="#{flujoSubPage.consultarFlujo}"
										 update="globalForm:popupFlujo">
							<f:setPropertyActionListener for="codConsultar" value="#{dato.codigo}" target="#{flujoSubPage.actividadRealizada.codigoInstancia}"/>
						</p:commandButton>

					</p:column>


				</p:dataTable>
			</h:panelGrid>

		</div>
	</ui:define>
</ui:composition>
 
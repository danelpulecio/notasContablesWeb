<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="../../common/template.xhtml">

    <ui:param name="title" value="Consulta de notas contables"/>
    <ui:define name="body">

        <ui:include src="../common/flujoSubPage.xhtml"/>
        <ui:include src="../notacontable/flujoNotaContablePage.xhtml"/>
        <ui:include src="../notacontable/flujoNotaContableLibrePage.xhtml"/>
        <ui:include src="../notacontable/flujoNotaRefCrucePage.xhtml"/>

        <!-- gp12833 - aseguramiento anexos -->
        <ui:include src="../notacontable/flujoAnexoNotaContablePage.xhtml"/>
        <!-- fin gp12833 - aseguramiento anexos -->

        <!--Filtro de busqueda  -->
        <div style="width: auto;">
            <h:panelGrid columns="1" width="100%">
                <h1 align="center">Notas Contables</h1>
            </h:panelGrid>
            <!-- Panel de opciones -->
            <!-- Campos del formulario -->
            <h:panelGrid id="informacion" columns="1" width="100%" cellpadding="0" cellspacing="0">
                <p:accordionPanel label="Filtro de búsqueda" width="100%" switchType="client">
                    <p:tab title="Filtro de búsqueda">
                        <h:panelGrid columns="2" width="100%" cellpadding="0" cellspacing="5">

                            <h:panelGrid columns="2">
                                <h:outputText value="Criterio"/>
                                <h:selectOneMenu value="#{consultaNotaContablePage.criterio}" immediate="true">
                                    <p:ajax event="change" update="filtro"></p:ajax>
                                    <f:selectItems value="#{consultaNotaContablePage.tiposCriterio}"/>
                                </h:selectOneMenu>
                            </h:panelGrid>
                            <h:panelGrid columns="2" id="filtro">
                                <h:outputText value="Número de radicación"
                                              rendered="#{consultaNotaContablePage.criterio eq '1'}"/>
                                <p:inputText value="#{consultaNotaContablePage.numRadicacion}"
                                             rendered="#{consultaNotaContablePage.criterio eq '1'}"/>
                                <h:outputText value="Asiento contable Altamira"
                                              rendered="#{consultaNotaContablePage.criterio eq '2'}"/>
                                <p:inputText value="#{consultaNotaContablePage.asientoContable}"
                                             rendered="#{consultaNotaContablePage.criterio eq '2'}"/>
                                <h:outputText value="Fecha Radicación Módulo"
                                              rendered="#{!(consultaNotaContablePage.criterio eq '1')}"/>
                                <p:calendar value="#{consultaNotaContablePage.fecha}"
                                            rendered="#{!(consultaNotaContablePage.criterio eq '1')}"/>
                            </h:panelGrid>

                            <h:panelGrid columns="1" styleClass="center">
                                <p:commandButton action="#{consultaNotaContablePage.buscar}" update="globalForm:informacion,globalForm:lista"
                                                 value="Buscar"/>
                            </h:panelGrid>
                        </h:panelGrid>
                    </p:tab>
                </p:accordionPanel>
            </h:panelGrid>

            <ui:include src="../../common/mensajes.xhtml"/>

            <!-- Tabla de registros -->

            <h:panelGrid columns="1" width="100%" style="align:center;" id="lista">

                <p:dataTable value="#{consultaNotaContablePage.datos}" var="dato" id="table" rowIndexVar="rowIndex"
                             widgetVar="economicActivityTable" rows="10" paginator="true"
                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             currentPageReportTemplate="{startRecord}-{endRecord} of {totalRecords} records"
                             paginatorPosition="top">

                    <p:column headerText="Número Radicación" sortable="true" sortBy="#{dato.NC.numeroRadicacion}" width="110px;">
                        <h:outputText value="#{dato.NC.numeroRadicacion}"/>
                    </p:column>
                    <p:column headerText="Sucursal Origen" sortable="true" sortBy="#{dato.sucursal.codigo}" width="120px;">
                            <h:outputText value="#{dato.sucursal.codigo} : #{dato.sucursal.nombre}"/>
                    </p:column>
                    <p:column headerText="Concepto" width="150px;">
                        <h:outputText
                                value="#{dato.NC.tipoNota eq 'C' ? 'Referencia de Cruce' : (dato.NC.tipoNota eq 'R' ? dato.concepto.nombre : 'Contabilidad Libre')}"/>
                    </p:column>
                    <p:column headerText="Usuario Asignado" sortable="true" sortBy="#{dato.usuMod.codigoEmpleado}" width="80px;">
                        <h:outputText value="#{dato.usuMod.codigoEmpleado}"/>
                    </p:column>
                    <p:column headerText="Área" sortable="true" sortBy="#{dato.usuMod.codigoAreaModificado}" width="120px;">
                            <h:outputText value="#{dato.usuMod.codigoAreaModificado} : #{dato.usuMod.nombreAreaModificado}"/>
                    </p:column>
                    <p:column headerText="Perfil" sortable="true" sortBy="#{dato.rol.nombre}" width="110px;">
                        <h:outputText value="#{dato.rol.nombre}"/>
                    </p:column>
                    <p:column headerText="Fecha Asignación" sortable="true" sortBy="#{dato.ultimaActualizacionTs}" width="80px;" >
                        <h:outputText value="#{dato.ultimaActualizacionTs}">
                            <f:convertDateTime timeZone="GMT-5" locale="es" pattern="dd-MMM-yyyy hh:mm:ss"/>
                        </h:outputText>
                    </p:column>

                    <p:column headerText="Estado" sortable="true" sortBy="#{dato.nombreEstado}" width="70px;">
                        <h:outputText value="#{dato.nombreEstado}"/>
                    </p:column>

                    <!-- gp12833 - aseguramiento anexos -->

                    <p:column headerText="Recuperar Anexos" style="text-align:center;" sortable="true"
                              sortBy="#{dato.nombreEstado}"
                              rendered="#{consultaNotaContablePage.procesoRecuperarAnexos}" width="70px;">
                        <p:commandButton value="Ver" oncomplete="PF('popupAnexosNotaContableVer').show()"
                                         action="#{flujoNotaContablePage.cargarAnexos}"
                                         update="globalForm:popupAnexosNotaContableVer">
                            <f:setPropertyActionListener for="numRadicadoNotaVer" value="#{dato.NC.numeroRadicacion}"
                                                         target="#{flujoNotaContablePage.numeroRadicacion}"/>
                        </p:commandButton>
                    </p:column>
                    <!-- FIN gp12833 - aseguramiento anexos -->

                    <p:column headerText="Ver Nota Contable" width="50px;" style="text-align:center;"
                              rendered="#{!consultaNotaContablePage.procesoRecuperarAnexos}">
                              
                        <p:commandButton value="Ver" 
                        				action="#{flujoNotaContablePage.consultarFlujo}"
                        				oncomplete="PF('popupFlujoNotaContableVer').show();"
                                        update="globalForm:popupFlujoNotaContableVer" 
                                        rendered="#{dato.NC.tipoNota eq 'R'}">
                            <f:setPropertyActionListener for="codNotaVer" value="#{dato.codigoNotaContable}"
                                                         target="#{flujoNotaContablePage.nota.codigo}"/>
                        </p:commandButton>
                        <p:commandButton value="Ver" oncomplete="PF('notaContableLibreVer').show()"
                                         action="#{flujoNotaContableLibrePage.consultarFlujo}"
                                         update="globalForm:notaContableLibreVer" 
                                         rendered="#{dato.NC.tipoNota eq 'L'}">
                            <f:setPropertyActionListener for="codNotaLibreVer" value="#{dato.codigoNotaContable}"
                                                         target="#{flujoNotaContableLibrePage.nota.codigo}"/>
                        </p:commandButton>
                        <p:commandButton value="Ver" oncomplete="PF('popupFlujoNotaContableRefCruceVer').show()"
                                         action="#{notaRefCrucePage.consultarFlujo}"
                                         update="globalForm:popupFlujoNotaContableRefCruceVer"
                                         rendered="#{dato.NC.tipoNota eq 'C'}">
                            <f:setPropertyActionListener for="codNotaRefCruceVer" value="#{dato.codigoNotaContable}"
                                                         target="#{notaRefCrucePage.nota.codigo}"/>
                        </p:commandButton>
                    </p:column>
                    <p:column headerText="Flujo Nota Contable" width="75px;" style="text-align:center;"
                              rendered="#{!consultaNotaContablePage.procesoRecuperarAnexos}">
                        <p:commandButton value="Consultar" 
                        				oncomplete="PF('popupFlujo').show()"
                                        action="#{flujoSubPage.consultarFlujo}" 
                                        update="globalForm:popupFlujo">
                            <f:setPropertyActionListener for="codConsultar" value="#{dato.codigo}"
                                                         target="#{flujoSubPage.actividadRealizada.codigoInstancia}"/>
                        </p:commandButton>
                    </p:column>
                </p:dataTable>
            </h:panelGrid>
        </div>
    </ui:define>
</ui:composition>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="../../common/template.xhtml">
    <ui:param name="title" value="Temas"/>
    <ui:define name="body">
        <p:growl id="growl" showDetail="false" life="5000"/>
        <p:dialog id="popupEstado" widgetVar="popupEstado" autosized="true" width="250">
            <f:facet name="header">
                <h:panelGroup><h:outputText value="Confirmación de cambio de estado"/></h:panelGroup>
            </f:facet>
            <f:facet name="controls">
                <h:panelGroup>
                    <h:graphicImage value="../../common/images/close.png" alt="cerrar" styleClass="hidelink"
                                    id="hidelinkEstado" height="20" width="20"/> </h:panelGroup>
            </f:facet>

            <h:panelGrid columns="1" width="100%">

                <h:outputText value="Está seguro que desea cambiar el estado del registro actual?"/>

                <!-- Seccion de mensajes y botones de envio y cancelacion-->
                <!--                <ui:include src="../../common/mensajes.xhtml"/>-->
                <h:panelGrid columns="2" styleClass="center" width="100%">
                    <p:commandButton value="Si"
                                     action="#{temaPage.cambiarEstado()}"
                                     oncomplete="PF('popupEstado').hide()"
                                     update="globalForm:table, globalForm:growl">

                    </p:commandButton>
                    <p:commandButton onclick="PF('popupEstado').hide()" value="No"/>
                </h:panelGrid>
            </h:panelGrid>
        </p:dialog>

        <!-- Formulario de confirmacion de borrado de informacion-->
        <p:dialog widgetVar="popupBorrar" id="popupBorrar" autosized="true" minWidth="250">
            <f:facet name="header">
                <h:panelGroup><h:outputText value="Confirmación de borrado de información"/></h:panelGroup>
            </f:facet>
            <f:facet name="controls">
                <h:panelGroup>
                    <h:graphicImage value="../../../common/images/close.png" alt="cerrar" styleClass="hidelink"
                                    id="hidelinkBorrar" height="20" width="20"/>
                    <p:commandButton for="popupBorrar" attachTo="hidelinkBorrar" operation="hide" event="onclick"/>
                </h:panelGroup>
            </f:facet>

            <h:panelGrid columns="1" width="100%">

                <h:outputText value="Está seguro que desea borrar la información del registro actual?"/>

                <!-- Seccion de mensajes y botones de envio y cancelacion-->
                <!--                <ui:include src="../../common/mensajes.xhtml"/>-->
                <h:panelGrid columns="2" styleClass="center" width="100%">
                    <p:commandButton action="#{temaPage.borrar}" value="Si" oncomplete="PF('popupBorrar').hide()"
                                     update="globalForm:table"/>
                    <p:commandButton onclick="PF('popupBorrar').hide()" value="No"/>
                </h:panelGrid>
            </h:panelGrid>
        </p:dialog>


        <!-- Formulario Modal de creacion y edicion de nuevos registros-->
        <p:dialog id="editor" widgetVar="editor" style="max-height: 500px; overflow: auto">
            <f:facet name="header">
                <h:panelGroup><h:outputText value="Formulario"/></h:panelGroup>
            </f:facet>
            <f:facet name="controls">
                <h:panelGroup>
                    <h:graphicImage value="../../common/images/close.png" alt="cerrar" styleClass="hidelink"
                                    id="hidelink" height="20" width="20"/>
                </h:panelGroup>
            </f:facet>

            <!-- Campos del formulario -->
            <h:panelGrid columns="1" width="820" id="informacion">
                <!--                <h:outputText>-->
                <div style="overflow:auto;width: 100%;">

                    <h:panelGrid columns="2" width="100%" cellpadding="0" cellspacing="5">

                        <h:outputText value="Concepto"/>
                        <h:panelGrid columns="2" id="tipoConcepto">
                            <p:inputText value="#{temaPage.concepto}" size="70"/>
                            <p:commandButton action="#{temaPage.buscarConcepto}" value="Buscar Concepto"
                                             update="globalForm:tipoConcepto"/>

                            <p:selectOneMenu value="#{temaPage.objActual.codigoConcepto}" immediate="true"
                                             converter="javax.faces.Integer"
                                             disabled="#{temaPage.objActual.codigo gt 0}" id="nombreCon"
                                             disabledClass="disabledItem" rendered="#{! empty temaPage.conceptos}">
                                <f:selectItem itemValue="-1" itemLabel="Seleccione una opcion"/>
                                <f:selectItems value="#{temaPage.conceptos}"/>
                            </p:selectOneMenu>
                        </h:panelGrid>

                        <h:outputText value="Nombre"/>
                        <p:inputText value="#{temaPage.objActual.nombre}" size="91"/>

                        <h:outputText value="Activar"/>
                        <p:selectOneMenu value="#{temaPage.objActual.activar}" immediate="true">
                            <f:selectItems value="#{temaPage.selectItemSiNo}"/>
                        </p:selectOneMenu>

                    </h:panelGrid>
                    <h:panelGrid columns="2" width="100%" cellpadding="0" cellspacing="5">
                        <p:panel header="Partida" style="height:170px;">

                            <h:panelGrid columns="2">
                                <h:outputText value="Cuenta"/>
                                <h:panelGrid columns="1">
                                    <h:panelGrid columns="2">
                                        <p:inputText value="#{temaPage.partidaContable}" immediate="true"
                                                     maxlength="20" size="12"/>
                                        <p:commandButton action="#{temaPage.buscarPartidaContable}" value="Buscar"
                                                         update="partContable, globalForm:growl"/>
                                    </h:panelGrid>
                                    <h:panelGrid columns="2" id="partContable">
                                        <p:selectOneMenu value="#{temaPage.objActual.partidaContable}"
                                                         style="width:250px;" immediate="true"
                                                         rendered="#{! empty temaPage.cuentas}">
                                            <f:selectItem itemValue=" " itemLabel="Seleccione una opcion"/>
                                            <f:selectItems value="#{temaPage.cuentas}"/>
                                        </p:selectOneMenu>
                                    </h:panelGrid>
                                </h:panelGrid>
                            </h:panelGrid>

                            <p:separator width="100%"/>

                            <h:panelGrid columns="5" id="opcPartida">
                                <h:outputText value="Naturaleza"/>
                                <p:selectOneMenu value="#{temaPage.objActual.naturaleza1}">
                                    <p:ajax event="change" update="globalForm:opcContraPartida" process="@this"
                                            listener="#{temaPage.cambioNat1}"/>
                                    <f:selectItem itemValue="D" itemLabel="Debe"/>
                                    <f:selectItem itemValue="H" itemLabel="Haber"/>
                                </p:selectOneMenu>

                                <p:spacer width="50"/>

                                <h:outputText value="Referencia"/>
                                <p:selectOneMenu value="#{temaPage.objActual.referencia1}" immediate="true">
                                    <f:selectItems value="#{temaPage.selectItemSiNo}"/>
                                </p:selectOneMenu>


                                <h:outputText value="Tercero"/>
                                <p:selectOneMenu value="#{temaPage.objActual.tercero1}" immediate="true">
                                    <f:selectItems value="#{temaPage.selectItemSiNo}"/>
                                </p:selectOneMenu>

                                <p:spacer width="50"/>

                                <p:outputLabel for="contrato1" value="Contrato"/>
                                <p:selectOneMenu id="contrato1" value="#{temaPage.objActual.contrato1}"
                                                 immediate="true">
                                    <p:ajax event="change" update="globalForm:prodGroup" process="@this"/>
                                    <f:selectItems value="#{temaPage.selectItemSiNo}"/>
                                </p:selectOneMenu>

                            </h:panelGrid>
                        </p:panel>
                        <p:panel header="Contra Partida" style="height:170px;">

                            <h:panelGrid columns="2">
                                <h:outputText value="Cuenta"/>
                                <h:panelGrid columns="1">
                                    <h:panelGrid columns="2">
                                        <p:inputText value="#{temaPage.contraPartidaContable}" immediate="true"
                                                     maxlength="20" size="12"/>
                                        <p:commandButton action="#{temaPage.buscarContraPartidaContable}"
                                                         value="Buscar" update="contraPartContable, globalForm:growl"/>
                                    </h:panelGrid>
                                    <h:panelGrid columns="2" id="contraPartContable">
                                        <p:selectOneMenu value="#{temaPage.objActual.contraPartidaContable}"
                                                         style="width:250px;" immediate="true"
                                                         rendered="#{! empty temaPage.cuentasContraPartida}">
                                            <f:selectItem itemValue=" " itemLabel="Seleccione una opcion"/>
                                            <f:selectItems value="#{temaPage.cuentasContraPartida}"/>
                                        </p:selectOneMenu>
                                    </h:panelGrid>
                                </h:panelGrid>
                            </h:panelGrid>

                            <p:separator width="100%"/>

                            <h:panelGrid columns="5" id="opcContraPartida">
                                <h:outputText value="Naturaleza"/>
                                <p:selectOneMenu value="#{temaPage.objActual.naturaleza2}">
                                    <p:ajax event="change" update="globalForm:opcPartida" process="@this"
                                            listener="#{temaPage.cambioNat2}"/>
                                    <f:selectItem itemValue="D" itemLabel="Debe"/>
                                    <f:selectItem itemValue="H" itemLabel="Haber"/>
                                </p:selectOneMenu>

                                <p:spacer width="50"/>

                                <h:outputText value="Referencia"/>
                                <p:selectOneMenu value="#{temaPage.objActual.referencia2}" immediate="true">
                                    <f:selectItems value="#{temaPage.selectItemSiNo}"/>
                                </p:selectOneMenu>

                                <h:outputText value="Tercero"/>
                                <p:selectOneMenu value="#{temaPage.objActual.tercero2}" immediate="true">
                                    <f:selectItems value="#{temaPage.selectItemSiNo}"/>
                                </p:selectOneMenu>

                                <p:spacer width="50"/>

                                <h:outputText value="Contrato"/>
                                <p:selectOneMenu value="#{temaPage.objActual.contrato2}" immediate="true">
                                    <p:ajax event="change" update="globalForm:prodGroup" process="@this"/>
                                    <f:selectItems value="#{temaPage.selectItemSiNo}"/>
                                </p:selectOneMenu>


                            </h:panelGrid>
                        </p:panel>
                    </h:panelGrid>
                    <h:panelGrid width="100%" cellpadding="0" cellspacing="5">
                        <p:panel header="Configuración">
                            <h:outputText value="Tipo de Divisa"/>
                            <p:spacer width="20"/>
                            <p:selectOneMenu value="#{temaPage.objActual.tipoDivisa}" immediate="true">
                                <f:selectItem itemValue="" itemLabel="Ninguna"/>
                                <f:selectItem itemValue="L" itemLabel="Moneda Local"/>
                                <f:selectItem itemValue="E" itemLabel="Moneda Extranjera"/>
                                <f:selectItem itemValue="M" itemLabel="Multidivisa"/>
                            </p:selectOneMenu>

                            <p:spacer width="20"/>
                            <h:outputText value="Riesgo Operacional"/>
                            <p:selectOneMenu value="#{temaPage.objActual.riesgoOperacional}" immediate="true">
                                <f:selectItems value="#{temaPage.selectItemSiNo}"/>
                            </p:selectOneMenu>

                            <p:spacer width="20"/>
                            <h:outputText value="Tema Obligatorio"/>
                            <p:selectOneMenu value="#{temaPage.objActual.obligatorio}" immediate="true">
                                <f:selectItems value="#{temaPage.selectItemSiNo}"/>
                            </p:selectOneMenu>
                        </p:panel>
                    </h:panelGrid>
                    <h:panelGrid columns="1" cellpadding="0" cellspacing="6" width="100%">
                        <p:panel style="width: 100%" header="Impuestos">
                            <p:selectManyCheckbox value="#{temaPage.impuestosSel}" immediate="true">
                                <f:selectItems value="#{temaPage.impuestos}"/>
                            </p:selectManyCheckbox>
                        </p:panel>
                    </h:panelGrid>
                    <h:panelGrid columns="1" id="prodGroup" cellpadding="0" cellspacing="5" width="100%">
                        <p:panel style="width: 100%" header="productos"
                                 rendered='#{temaPage.objActual.contrato1 eq "S" or temaPage.objActual.contrato2 eq "S"}'>
                            <p:pickList id="example" value="#{temaPage.dualListModel}" var="pr"
                                        itemValue="#{pr.value}" itemLabel="#{pr.label}"/>
                            <f:selectItems value="#{temaPage.productos}"/>
                            <h:outputText rendered="${empty temaPage.productosSel}"
                                          value="El tema requiere Contrato(s) y no ha seleccionado ningún producto."/><br/>
                            <h:outputText rendered="${empty temaPage.productosSel}"
                                          value="En el momento de radicar Notas Contables se visualizarón los contratos de todos los tipos de productos del cliente."/>
                        </p:panel>

                    </h:panelGrid>
                    <!--                    <ui:include src="../../common/mensajes.xhtml"/>-->
                </div>
                <!--                </h:outputText>-->
                <!-- Seccion de mensajes y botones de envio y cancelacion-->
                <h:panelGrid columns="2" styleClass="center" width="100%">
                    <p:commandButton action="#{temaPage.guardar}" update="globalForm:informacion,globalForm:table"
                                     value="Guardar"
                                     oncomplete="if (#{temaPage.ocultarPopupGuardar}) PF('editor').hide();"/>
                    <p:commandButton onclick="PF('editor').hide()" value="Cerrar"/>
                </h:panelGrid>
            </h:panelGrid>
        </p:dialog>
        <div style="width: 1200px;">
            <!--Filtro de busqueda -->
            <h:panelGrid columns="1" width="100%"><h1 align="center">Temas</h1></h:panelGrid>

            <!-- Panel de opciones -->
            <p:panel header="Opciones" style="width: 100%;">
                <h:panelGrid columns="2" id="filtro">

                    <h:panelGrid columns="1" width="380">
                        <!-- Funcionalidad para abrir el editor y crear un nuevo registro-->
                        <p:commandButton action="#{temaPage.editar}"
                                         oncomplete="PF('editor').show()"
                                         update="globalForm:editor"
                                         value="Nuevo Registro"
                                         ajax="true">
                            <f:setPropertyActionListener for="codNuevo" value="#{0}"
                                                         target="#{temaPage.objActual.codigo}"/>
                        </p:commandButton>
                    </h:panelGrid>

                    <h:panelGrid columns="2">
                        <p:inputText value="#{temaPage.param}"/>
                        <p:commandButton action="#{temaPage.buscarPorFiltro}" value="Filtrar"
                                         onclick="Richfaces.showModalPanel('statusPanel')"/>
                    </h:panelGrid>
                </h:panelGrid>
            </p:panel>

            <!--        <ui:include src="../../common/mensajes.xhtml"/>-->
            <!--        <h:panelGrid columns="1" width="100%" style="text-align:center;" id="lista">-->
            <p:dataTable value="#{temaPage.datos}" var="dato" id="table" rows="3" widgetVar="table"
                         rendered="#{! empty temaPage.datos}"
                         rowKey="#{0}" width="100%"
                         footerClass="row2" rowClasses="row1"
                         paginator="true"
                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                         currentPageReportTemplate="{startRecord}-{endRecord} de {totalRecords} registros"
                         paginatorPosition="top">
                <p:column headerText="Concepto     -     Temas asociados a cada concepto" sortBy="ASCENDING">
                    <h:outputText value="#{dato.codigo}: #{dato.nombre}     -     #{dato.codSucursal} : #{dato.nombreSucursal}"/>
                </p:column>

<!--                <p:column headerText="Temas asociados a cada concepto">-->
<!--                    <h:outputText value="#{dato.codSucursal} : #{dato.nombreSucursal}"/>-->
<!--                </p:column>-->

                <f:facet name="header">
                    Expand rows to see detailed information
                </f:facet>
                <p:column style="width:2rem" colspan="2">
                    <p:rowToggler/>
                </p:column>


                <p:rowExpansion>
                    <!--                    <div class="product">-->
                    <!--                        <div class="product-list-item">-->
                    <!--                            <h:panelGrid columns="1" width="100%" style="text-align:center;" id="rowexpan">-->
                    <p:dataTable value="#{dato.temas}" var="tema" rows="5" id="tableRowExapand">
                        <p:column headerText="Unidad de Análisis" breakBefore="true">
                            <h:outputText value=""/>
                        </p:column>
                        <p:column headerText="Nombre del tema" breakBefore="true">
                            <h:outputText value="#{tema.nombre}"/>
                        </p:column>
                        <p:column headerText="Partida">
                            <h:outputText value="#{tema.partidaContable}"/>
                        </p:column>
                        <p:column headerText="Contrapartida">
                            <h:outputText value="#{tema.contraPartidaContable}"/>
                        </p:column>
                        <p:column headerText="Estado" style="text-align:center;">
                            <p:commandButton value="#{tema.estado eq 'A'? 'Activo': 'Inactivo'}"
                                             onclick="PF('popupEstado').show()">
                                <f:setPropertyActionListener for="codCambio" value="#{tema.codigo}"
                                                             target="#{temaPage.objActual.codigo}"/>
                                <f:setPropertyActionListener for="estadoCambio" value="#{tema.estado}"
                                                             target="#{temaPage.objActual.estado}"/>
                            </p:commandButton>
                        </p:column>
                        <p:column headerText="Editar" style="text-align:center;">
                            <p:commandButton value=""
                                             alt="Editar"
                                             style="width: 24px; height: 24px; padding: 0; background-image: url('#{request.contextPath}/common/images/edit.png'); background-size: cover; border-radius: 50%;"
                                             action="#{temaPage.editar}"
                                             oncomplete="PF('editor').show()"
                                             update="globalForm:editor">
                                <f:setPropertyActionListener for="codEdit" value="#{tema.codigo}"
                                                             target="#{temaPage.objActual.codigo}"/>
                            </p:commandButton>
                        </p:column>
                        <p:column headerText="Eliminar" style="text-align:center;">
                            <p:commandButton value=""
                                             alt="Borrar"
                                             style="width: 24px; height: 24px; padding: 0; background-image: url('#{request.contextPath}/common/images/delete.png'); background-size: cover; border-radius: 50%;"
                                             onclick="PF('popupBorrar').show()"
                                             rendered="#{tema.estado eq 'I'}">
                                <f:setPropertyActionListener for="codBorrar" value="#{tema.codigo}"
                                                             target="#{temaPage.objActual.codigo}"/>
                            </p:commandButton>
                        </p:column>
                    </p:dataTable>
                    <!--                            </h:panelGrid>-->
                    <!--                        </div>-->
                    <!--                    </div>-->
                </p:rowExpansion>
            </p:dataTable>
        </div>
    </ui:define>
</ui:composition>